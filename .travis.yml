language: ruby
rvm: 2.5.1
services: postgresql
bundler_args: "--without production -j4"
cache: bundler
before_script:
  - bundle exec rake db:create
  - bundle exec rake db:migrate
script: bundle exec rake test
deploy:
  provider: heroku
  api_key:
    secure: oAqCRwAs2ILK09L1kEzRMv5wWlpThCkkelLVFLwJ6+j5o3yWbDf+5b4lQ2EOWl3Q4u0RMjCxOdBbfYGadHQJ/cXsuPfBV+HBpix88BNG438GMueoN38hcsBQkodMKZwge0i2gChNBJDY2BAeNWL4tqx64+fRXejdRCOBfm4i5Lu6dvncvPCHvx1wTGR/hlyUce/1FwkbWYRcmbZALo3P8yubaSdGLOm0RyDBVPS0vNFNZSiIr51tlhILyGGpdO6v+iMVOoojnCInFFzRQmMimUwfwpuIKgt1exJDhzj3+flNUMVdmKuZU9YbMHnUf/mY6J5MGvNORxLdmC9Y7oPbtgToYeHi9bHgriUxfZOfmuu02S6RH0vd+vSrYbg4QtfH4TBk6JtbKumBuNiZ5Dxnn8HWH4cc5AA48g8EgzKvmJhqtykzdNlPxwBsJcKqs45lQFujOdS4VHQ8ruDPcUeJDKl6f0bvqQ9rS7+tNdqcOAQDzVCJ1wGSrjd6yGe4Q17DR90AQamwxjOIKYadqNJ+XmFHh0KPjsMXX/BDroUZPSIAJGek+vsWkdwve7fOgRIhdHQ3uy2rMDjZnq31oHHIAyUV4zrXwXyOV8/BWlsXCYnDImGvDxHZgd6UP37XFY4hxlXivkQKa2JC+CGVEnZxC0D4jsD/Yd4MYbROg3977oo=
  app: ydmsample-201901-stage
  on:
    repo: yosi-q/ydmsample-201901
  run:
    - bundle exec rake db:migrate
    - bundle exec rake cleanup
notifications:
  slack:
    rooms:
      - secure: "BZFjOAr2vEjzRCeNQCe0WkSVIeH1X0WCI511zkQAFf4+NlHKhwC4s87HDw6nIPIU09gU9vvm/7PCW88Xobsq/2emCyQ2lJl3dnRmzgAM/A1UakdRzG/TLKrvvRsChh0RRAdu4itOpxcznnSPXCfoGENgwL/XjA/pZET7T0XU7/romZ9DvcyOZMJ8CRRpHmiYePlgLI3aB3kx/tccKMLeo1wWcnYudA2NXZtJKaOB54/UWe8MSy6L902MNHri7hzAGbSCqvzNUYrCs2U1qYSlF0gpfbrIPNWDYex90i6qwxjTF/cAzlmfujSPpGYVCaDcJ+P3R/LJWKKDhvEGjA87uBNC+vFdwhl2jwRY5XW+fFcGTQrPDsvVzvu6hC+5lmFkKC0d3uvYchjwvEAZVEORdNnDS+MHiQYxd8hUVTowrwES4zGI4+4viRQyN0+La09jIeZ61tMBPYrSAhz/yNj9JcvSdRHs9a1lZ7fG8somB6ceZadTN6gOjIsQWFsfTfzNFPN+wPZRG90qJMejlZIGywk+Rbkd0KnGUUR0kGdW1jE4LIKqtbcBq29YtOh1iEnSCbwb9d/tH7Ne3QvWmNvd2iZHx/dKX6XS/RDPa6W5cM5VoF+4tLZ5WmXRa/2omK2V+6I3zeW2WK2uscpwOWlN+jEmejd8AtlYCuQLBJf3sks="
    on_success: always
    on_failure: always
    on_pull_requests: true
